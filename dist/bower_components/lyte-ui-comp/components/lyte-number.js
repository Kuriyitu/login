Lyte.Component.register("lyte-number",{_template:'<template tag-name="lyte-number">\n\t<template is="if" value="{{ltPropLabel}}"><template case="true">\n\t\t<label for="{{ltPropId}}" class="lyteLabel">{{ltPropLabel}}</label>\n\t</template></template>\n\t<div class="lyteField">\n\t\t<input type="text" name="{{ltPropName}}" class="{{ltPropClass}}" id="{{ltPropId}}" placeholder="{{ltPropPlaceholder}}" value="{{lbind(ltPropValue)}}" onkeydown="{{action( \'keydown\', event, this)}}" onpaste="{{action(\'paste\', event, this)}}" oninput="{{action(\'input\', event, this)}}" onfocus="{{action( \'focus\', event, this )}}" onblur="{{action( \'blur\', event, this )}}" onwheel="{{action(\'wheel\', event, this)}}" disabled="{{ltPropDisabled}}" readonly="{{ltPropReadonly}}" style="{{ltPropStyle}}" title="{{ltPropInputTitle}}" pattern="{{ltPropPattern}}" autocomplete="{{ltPropAutocomplete}}">\n\t</div>\n</template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[3,1],attr:{style:{name:"style",dynamicValue:"ltPropStyle"}}}],_observedAttributes:["ltPropValue","ltPropMaxlength","ltPropName","ltPropClass","ltPropId","ltPropPlaceholder","ltPropIgnoreSymbols","ltPropStep","ltPropInverse","ltPropWheel","ltPropMax","ltPropMin","ltPropAutofocus","ltPropDisabled","ltPropReadonly","ltPropStyle","ltPropInputTitle","ltPropPattern","ltPropUpdateDelay","ltPropLabel","ltPropAutocomplete","ltPropAppearance","ltPropDirection","ltPropValidateOnInput","ltPropAutoUpdate","ltPropDecimal","ltPropIncrement","ltPropFireOnInit","ltPropValidateOnEmpty"],didConnect:function(){["focus","blur","click","select"].forEach(function(t){this.$node[t]=function(e){this.$node.querySelector("input")[t](e)}.bind(this)}.bind(this)),this.data.ltPropAutofocus&&this.$node.focus(),this.getMethods("afterRender")&&this.executeMethod("afterRender",this.$node)},init:function(){this.getMethods("beforeRender")&&this.executeMethod("beforeRender",this.$node)},didDestroy:function(){clearTimeout(this._time)},data:function(){return{ltPropValue:Lyte.attr("string",{default:""}),ltPropMaxlength:Lyte.attr("number",{default:void 0}),ltPropName:Lyte.attr("string",{default:void 0}),ltPropClass:Lyte.attr("string",{default:void 0}),ltPropId:Lyte.attr("string",{default:void 0}),ltPropPlaceholder:Lyte.attr("string",{default:""}),ltPropIgnoreSymbols:Lyte.attr("boolean",{default:!1}),ltPropStep:Lyte.attr("number",{default:1}),ltPropInverse:Lyte.attr("boolean",{default:!1}),ltPropWheel:Lyte.attr("boolean",{default:!0}),ltPropMax:Lyte.attr("number",{default:void 0}),ltPropMin:Lyte.attr("number",{default:void 0}),ltPropAutofocus:Lyte.attr("boolean",{default:!1}),ltPropDisabled:Lyte.attr("boolean",{default:!1}),ltPropReadonly:Lyte.attr("boolean",{default:!1}),ltPropStyle:Lyte.attr("string",{default:""}),ltPropInputTitle:Lyte.attr("string",{default:void 0}),ltPropPattern:Lyte.attr("string",{default:".+"}),ltPropUpdateDelay:Lyte.attr("number",{default:250}),ltPropLabel:Lyte.attr("string",{default:""}),ltPropAutocomplete:Lyte.attr("string",{default:"off"}),ltPropAppearance:Lyte.attr("string",{default:"box"}),ltPropDirection:Lyte.attr("string",{default:"vertical"}),ltPropValidateOnInput:Lyte.attr("boolean",{default:!1}),ltPropAutoUpdate:Lyte.attr("boolean",{default:!0}),ltPropDecimal:Lyte.attr("string",{default:"."}),ltPropIncrement:Lyte.attr("boolean",{default:!0}),ltPropFireOnInit:Lyte.attr("boolean",{default:!1}),ltPropValidateOnEmpty:Lyte.attr("boolean",{default:!0})}},valueObs:function(t){if(!this._init){var e=!t;if(t?t.newValue=t.newValue||"":t={newValue:this.data.ltPropValue||""},this._allowCallback)return delete this._allowCallback,void(this.getMethods("onValueChange")&&this.executeMethod("onValueChange",t,this.$node));var a=t.newValue;if(e&&!this.data.ltPropFireOnInit&&(this._init=!0),this.validate(a))return this._valueUpdate(""),void delete this._init;if(a=this.maxLenValidation(a),(this.data.ltPropValidateOnEmpty&&!t.newValue||t.newValue)&&(a=this.maxMinCheck(a,!0)),t.newValue!=a)this._valueUpdate(a);else if(!this._init){if(e&&t.newValue==a)return;this.getMethods("onValueChange")&&this.executeMethod("onValueChange",t,this.$node)}delete this._init}}.observes("ltPropValue").on("didConnect"),maxMinOns:function(){this._valueUpdate(this.maxMinCheck(this.data.ltPropValue,!0))}.observes("ltPropMax","ltPropMin"),appearanceObs:function(){/box/i.test(this.data.ltPropAppearance)?(this.$node.classList.add("lyteInputBox"),this.$node.classList.remove("lyteInput")):(this.$node.classList.remove("lyteInputBox"),this.$node.classList.add("lyteInput"))}.observes("ltPropAppearance").on("didConnect"),directionObs:function(){/vertical/i.test(this.data.ltPropDirection)?(this.$node.classList.add("vertical"),this.$node.classList.remove("horizontal")):(this.$node.classList.remove("vertical"),this.$node.classList.add("horizontal"))}.observes("ltPropDirection").on("didConnect"),disAbs:function(){this.$node.classList[this.data.ltPropDisabled?"add":"remove"]("lyteNumberDisabled")}.observes("ltPropDisabled").on("didConnect"),readAbs:function(){this.$node.classList[this.data.ltPropReadonly?"add":"remove"]("lyteNumberReadonly")}.observes("ltPropReadonly").on("didConnect"),increment:function(t,e){var a=t.value||"0",i=(Number(a)+this.data.ltPropStep*(e?1:-1)).toString();i!=1/0&&i!=-1/0&&(i=this.maxLenValidation(i),i=this.maxMinCheck(i,!0),t.value=i,t.selectionEnd=i.length,t.selectionStart=i.length,this.data.ltPropAutoUpdate&&this.valueUpdate(t))},actions:{keydown:function(t,e){var a,i=t.which||t.keyCode,l=e.selectionStart,o=e.selectionEnd,n=this.data.ltPropIncrement;if(8==i){if(l==o&&0==o)return;this._prevent=!0}else n&&38==i?(this.increment(e,!this.data.ltPropInverse),a=!0):n&&40==i&&(this.increment(e,this.data.ltPropInverse),a=!0);a&&t.preventDefault()},wheel:function(t,e){this.data.ltPropWheel&&this._focused&&!this.data.ltPropDisabled&&!this.data.ltPropReadonly&&(t.deltaY>10?this.increment(e,!this.data.ltPropInverse):t.deltaY<-10&&this.increment(e,this.data.ltPropInverse),t.preventDefault())},paste:function(t,e){t.preventDefault();var a=t.clipboardData||window.clipboardData,i=e.value,l=e.selectionStart,o=e.selectionEnd,n=this.data.ltPropDecimal,r=a.getData("text").trim().replace(/^(\'|\")|(\'|\")$/,"").replace(new RegExp("[^0-9e\\+\\-\\"+n+"]","g"),""),s=i.slice(0,l)+r+i.slice(o);if(this.validate(s)&&(s=this.convertToNo(s)),Number(i)!=1/0&&Number(i)!=-1/0){if(this.getMethods("onBeforePaste")){var d=this.executeMethod("onBeforePaste",e.value,a.getData("text"),s);if(void 0!=d)s=d;else if(0==d)return}s=this.maxLenValidation(s),s=this.maxMinCheck(s,!0),e.value=s,e.selectionStart=o+r.length,e.selectionEnd=o+r.length,this.data.ltPropAutoUpdate&&this._valueUpdate(e.value)}},input:function(t,e){var a;this._prevent&&(delete this._prevent,this.data.ltPropAutoUpdate&&this.valueUpdate(e),a=!0);var i=e.value,l=i,o=e.selectionStart,n=e.selectionEnd,r=!a&&this.validate(i);if(r)if(/insertText/i.test(t.inputType)){var s=parseFloat(t.data);isNaN(s)?(i=i.slice(0,n-t.data.length)+i.slice(n),n=n-t.data.length+1):(s=s.toString(),i=i.slice(0,n-t.data.length)+s+i.slice(n),n=n-t.data.length+1+s.length)}else i=i.slice(0,o-1)+i.slice(n);else i=this.maxLenValidation(i),i=this.maxMinCheck(i,this.data.ltPropValidateOnInput);e.value=i,r?(e.selectionStart=Math.min(n-1,i.length),e.selectionEnd=Math.min(n-1,i.length)):l!=i?e.selectionStart=e.selectionEnd=i.length:(e.selectionStart=Math.min(o,i.length),e.selectionEnd=Math.min(n,i.length)),this.data.ltPropAutoUpdate&&this.valueUpdate(e)},focus:function(t,e){this._focused=!0,this.$node.classList.add("lyteInputFocus"),this.getMethods("onFocus")&&this.executeMethod("onFocus",t,this.$node)},blur:function(t,e){delete this._focused,this.$node.classList.remove("lyteInputFocus"),(e.value||!e.value&&this.data.ltPropValidateOnEmpty)&&(e.value=this.maxMinCheck(e.value,!0)),this._valueUpdate(e.value,!0),this.getMethods("onBlur")&&this.executeMethod("onBlur",t,this.$node)}},valueUpdate:function(t){t=t||this.$node.getElementsByTagName("input")[0],void 0==this.data.ltPropUpdateDelay?this._valueUpdate(t.value):(clearTimeout(this._time),this._time=setTimeout(this._valueUpdate.bind(this,t.value),this.data.ltPropUpdateDelay))},_valueUpdate:function(t,e){if(e){var a=new RegExp("\\"+this.data.ltPropDecimal+"$");/e$/i.test(t)&&(t=t.replace(/e$/,"")),a.test(t)&&(t=t.replace(a,""))}t!=this.data.ltPropValue&&(this._allowCallback=!0,this.$node.ltProp("value",t))},validate:function(t){var e,a,i=/e/gi,l=/(\+|\-)/g,o=this.data.ltPropDecimal,n=new RegExp("\\"+o,"g");return i.test(t)&&(t.match(i).length>1&&(a=!0),/^e/i.test(t)?a=!0:(e=/e/gi.exec(t).index,t=t.replace(i,""))),l.test(t)&&(t.match(l).length>1?a=!0:/^(\+|\-)/g.test(t)?t=t.replace(l,""):a=!0),n.test(t)&&(t.match(n).length>1||void 0!=e&&e<t.indexOf(o)?a=!0:/^(\+|\-)/g.test(t)&&1==t.indexOf(o)&&2==e||!/^(\+|\-)/g.test(t)&&0==t.indexOf(o)&&1==e?a=!0:t=t.replace(n,"")),!a&&t.length&&(a=!/^\d+$/.test(t)),a},maxLenValidation:function(t){var e,a=this.data.ltPropMaxlength,i=t.length,l=this.data.ltPropDecimal;if(void 0==a)return t;if(!this.data.ltPropIgnoreSymbols&&(a+=/^(\+|\-)/.test(t)?1:0,new RegExp("\\"+l).test(t)&&(e=new RegExp("\\"+l,"g").exec(t).index,a++),/e/i.test(t))){var o=/e/i.exec(t).index,n=t.slice(o+1),r=parseInt(n);if(n.length){i--;var s=void 0!=e?t.slice(e+1,o).length:0;if(s<=r&&(void 0!=e&&(i--,a--),i-=s),i-=n.length,(i+=r)>a){if(r>i-a)return t.slice(0,o)+"e"+(r-(i-a));t=t.split(/e/i)[0].match(new RegExp(".{0,"+a+"}"))[0]}return t}a++}return t.match(new RegExp(".{0,"+a+"}"))[0]},maxMinCheck:function(t,e){var a=t,i=this.data.ltPropMax,l=this.data.ltPropMin,o=Number(t.replace(new RegExp("\\"+this.data.ltPropDecimal),".")),n=this.getMethods("onBeforeMaxMinValidation");if(void 0==i&&void 0==l)return t;void 0!=i&&(i<o&&(t=i,t=void 0==(r=n?this.executeMethod("onBeforeMaxMinValidation","max",a,t,this.$node):t)?t:r));if(e&&void 0!=l)if(l>o)t=l,t=l,t=void 0==(r=n?this.executeMethod("onBeforeMaxMinValidation","min",a,t,this.$node):t)?t:r;else if(0==o&&""==t){var r;t=Math.max(o,l),t=void 0==(r=n?this.executeMethod("onBeforeMaxMinValidation","min",a,t,this.$node):t)?t:r}return t.toString().replace(/\./,this.data.ltPropDecimal)},removeTwice:function(t,e){var a=t.split(e);a.length>1&&(t=a.shift()+e.exec(t)[0]+a.join(""));return t},convertToNo:function(t){var e,a,i=this.data.ltPropDecimal,l=new RegExp("\\"+i),o=/e/i;return t=this.removeTwice(t,l),t=this.removeTwice(t,o),t=this.removeTwice(t,/\+|\-/i),l.test(t)&&o.test(t)&&((e=l.exec(t).index)>(a=o.exec(t).index)||1==Math.abs(e-a))&&(t=t.replace(e>a?o:l,"")),/^e/i.test(t)&&(t=t.replace(/e/i,"")),/\+|\-/.test(t)&&!/^(\+|\-)/.test(t)&&(void 0!=a&&/\+|\-/.exec(t).index!=a+1||void 0==a)&&(t=t.replace(/\+|\-/g,"")),t}});